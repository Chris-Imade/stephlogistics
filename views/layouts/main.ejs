<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <title><%= title %></title>

    <!-- Favicon -->
    <link
      rel="shortcut icon"
      href="/assets/images/favicon.ico"
      type="image/x-icon"
    />

    <!--Start css files-->
    <link
      rel="stylesheet preload"
      href="/assets/css/font-awesome-pro.css"
      as="style"
    />
    <link
      rel="stylesheet preload"
      href="/assets/css/bootstrap.min.css"
      as="style"
    />
    <link rel="stylesheet preload" href="/assets/css/swiper.css" as="style" />
    <link
      rel="stylesheet preload"
      href="/assets/css/nice-select.css"
      as="style"
    />
    <link rel="stylesheet preload" href="/assets/css/animate.css" as="style" />
    <link
      rel="stylesheet preload"
      href="/assets/css/odometer-theme-default.min.css"
      as="style"
    />
    <link
      rel="stylesheet preload"
      href="/assets/css/magnific-popup.css"
      as="style"
    />
    <link
      rel="stylesheet preload"
      href="/assets/css/franchise.css"
      as="style"
    />
    <link rel="stylesheet preload" href="/assets/css/ecom.css" as="style" />
    <link rel="stylesheet preload" href="/assets/css/style.css" as="style" />
    <link rel="stylesheet preload" href="/assets/css/toast.css" as="style" />
    <link rel="stylesheet" href="/assets/css/legal.css" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/wowjs@1.1.3/css/libs/animate.min.css"
    />
    <!-- End Css File -->

    <!-- Additional CSS for specific pages -->
    <% if (typeof extraCSS !== 'undefined') { %> <%- extraCSS %> <% } %>

    <!-- Start Favicon-->
    <link
      rel="shortcut icon"
      type="image/x-icon"
      href="/assets/images/favicon.png"
    />
    <!-- End Favicon -->

    <style>
      /* Add toast notification styling */
      .toast-container {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 9999;
        display: flex;
        flex-direction: column;
        align-items: flex-end;
      }

      .toast {
        min-width: 300px;
        margin-bottom: 10px;
        padding: 15px;
        border-radius: 4px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        transform: translateX(100%);
        opacity: 0;
        transition: transform 0.3s ease, opacity 0.3s ease;
      }

      .toast.show {
        transform: translateX(0);
        opacity: 1;
      }

      .toast.success {
        background-color: #ebf7ee;
        border-left: 4px solid #34c759;
      }

      .toast.error {
        background-color: #feecf0;
        border-left: 4px solid #ff3b30;
      }

      .toast-content {
        display: flex;
        align-items: center;
      }

      .toast-icon {
        margin-right: 12px;
        font-size: 18px;
      }

      .toast.success .toast-icon {
        color: #34c759;
      }

      .toast.error .toast-icon {
        color: #ff3b30;
      }

      .toast-message {
        font-size: 14px;
        font-weight: 500;
        color: #333;
      }
    </style>
  </head>
  <body>
    <!-- Start Site Preloader -->
    <div id="trucker__preloader">
      <div id="trucker__circle_loader"></div>
      <div class="trucker__loader_logo">
        <img src="/assets/images/logo/logo.png" alt="Preload" />
      </div>
    </div>
    <!-- End Site Preloader -->

    <!-- Start Scroll To Top Here  -->
    <div class="scroll-up">
      <svg
        class="scroll-circle svg-content"
        width="100%"
        height="100%"
        viewBox="-1 -1 102 102"
      >
        <path d="M50,1 a49,49 0 0,1 0,98 a49,49 0 0,1 0,-98" />
      </svg>
    </div>
    <!-- End Scroll To Top Here -->

    <!-- Header -->
    <%- include ../partials/navbar %>

    <!-- Main Content -->
    <main><%- body %></main>

    <!-- Footer -->
    <%- include ../partials/footer %>

    <!-- Start Overlay Add -->
    <div class="trucker__overlay"></div>
    <!-- End Overlay Add -->

    <!--Start Js Files-->
    <!-- Bootstrap from CDN -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script
      src="https://code.jquery.com/jquery-3.7.1.min.js"
      integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo="
      crossorigin="anonymous"
    ></script>
    <script src="https://cdn.jsdelivr.net/npm/wowjs@1.1.3/dist/wow.min.js"></script>

    <!-- Only include the JS files that actually exist in our project -->
    <script defer src="/assets/js/magnific-popup.js"></script>
    <script defer src="/assets/js/nice-select.js"></script>
    <script defer src="/assets/js/swiper.js"></script>
    <script defer src="/assets/js/odometer.min.js"></script>
    <script defer src="/assets/js/jarallax.min.js"></script>
    <script defer src="/assets/js/imagesloaded-pkgd.js"></script>
    <script defer src="/assets/js/utils.js"></script>
    <script defer src="/assets/js/script.js"></script>

    <!-- End Js File -->

    <!-- Additional JS for specific pages -->
    <% if (typeof extraJS !== 'undefined') { %> <%- extraJS %> <% } %>

    <!-- Fix for WOW.js animations -->
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // Wait for the main JavaScript to initialize
        setTimeout(function () {
          // Force all fade-up elements to be visible
          document.querySelectorAll(".fade-up").forEach(function (el) {
            el.style.opacity = "1";
            el.style.visibility = "visible";
            el.style.transform = "translateY(0)";
            el.classList.add("active");
          });

          // Initialize counter animations for the stats
          document.querySelectorAll(".stat-number").forEach(function (counter) {
            const target = parseInt(counter.getAttribute("data-count"), 10);
            if (target) {
              // Set initial value to 0
              counter.textContent = "0";

              // Create animation effect
              let current = 0;
              const increment = target / 50; // Divide animation into 50 steps
              const timer = setInterval(function () {
                current += increment;
                counter.textContent = Math.round(Math.min(current, target));
                if (current >= target) {
                  clearInterval(timer);
                }
              }, 30);
            }
          });
        }, 1000); // Give the main JS time to initialize
      });
    </script>
    <script>
      function submitContactForm() {
        const form = document.getElementById("contactForm");
        const submitButton = document.getElementById("contactSubmitButton");
        const submitText = document.getElementById("contactSubmitText");
        const submitSpinner = document.getElementById("contactSubmitSpinner");
        const errorMessage = document.getElementById("contactErrorMessage");
        const errorText = document.getElementById("contactErrorText");

        // Check form validity
        if (!form.checkValidity()) {
          form.reportValidity();
          return;
        }

        // Disable submit button and show spinner
        submitButton.disabled = true;
        submitText.textContent = "Sending...";
        submitSpinner.classList.remove("d-none");
        errorMessage.classList.add("d-none");

        const formData = {
          name: document.getElementById("contactName").value,
          email: document.getElementById("contactEmail").value,
          phone: document.getElementById("contactPhone").value,
          message: document.getElementById("contactMessage").value,
        };

        fetch("/franchise/submit-contact", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify(formData),
        })
          .then((response) => response.json())
          .then((data) => {
            if (data.success) {
              // Show toast if available
              if (typeof showToast === "function") {
                showToast("Message sent successfully!", "success");
              }

              // Reset form and close modal
              form.reset();
              bootstrap.Modal.getInstance(
                document.getElementById("contactModal")
              ).hide();
            } else {
              throw new Error(data.message || "Failed to send message");
            }
          })
          .catch((error) => {
            console.error("Error sending message:", error);
            errorText.textContent = error.message || "Error sending message";
            errorMessage.classList.remove("d-none");

            // Show toast if available
            if (typeof showToast === "function") {
              showToast("Error sending message. Please try again.", "error");
            }
          })
          .finally(() => {
            // Re-enable submit button and hide spinner
            submitButton.disabled = false;
            submitText.textContent = "Send Message";
            submitSpinner.classList.add("d-none");
          });
      }
    </script>
    <script>
      function submitFranchiseForm() {
        const form = document.getElementById("franchiseForm");
        const submitButton = document.getElementById("submitButton");
        const submitText = document.getElementById("submitButtonText");
        const submitSpinner = document.getElementById("submitSpinner");
        const successMessage = document.getElementById("successMessage");
        const errorMessage = document.getElementById("errorMessage");
        const errorText = document.getElementById("errorText");

        // Check form validity
        if (!form.checkValidity()) {
          form.reportValidity();
          return;
        }

        // Disable submit button and show spinner
        submitButton.disabled = true;
        submitText.textContent = "Submitting...";
        submitSpinner.classList.remove("d-none");
        errorMessage.classList.add("d-none");
        successMessage.classList.add("d-none");

        const formData = {
          firstName: document.getElementById("firstName").value,
          lastName: document.getElementById("lastName").value,
          email: document.getElementById("email").value,
          phone: document.getElementById("phone").value,
          location: document.getElementById("location").value,
          investment: document.getElementById("investment").value,
          experience: document.getElementById("experience").value,
          timeline: document.getElementById("timeline").value,
        };

        fetch("/franchise/submit-application", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify(formData),
        })
          .then((response) => response.json())
          .then((data) => {
            if (data.success) {
              // Show success message
              successMessage.classList.remove("d-none");

              // Show toast if available
              if (typeof showToast === "function") {
                showToast("Application submitted successfully!", "success");
              }

              // Reset form
              form.reset();
            } else {
              throw new Error(data.message || "Failed to submit application");
            }
          })
          .catch((error) => {
            console.error("Error submitting application:", error);
            errorText.textContent =
              error.message || "Error submitting application";
            errorMessage.classList.remove("d-none");

            // Show toast if available
            if (typeof showToast === "function") {
              showToast(
                "Error submitting application. Please try again.",
                "error"
              );
            }
          })
          .finally(() => {
            // Re-enable submit button and hide spinner
            submitButton.disabled = false;
            submitText.textContent = "Submit Application";
            submitSpinner.classList.add("d-none");
          });
      }
    </script>
  </body>
</html>
